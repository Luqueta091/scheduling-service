
> scheduling-service@0.1.0 test:ci
> vitest run --config vitest.config.ts


 RUN  v1.6.1 /Users/joelsonqueiroz/CascadeProjects/scheduling-service

{"level":30,"time":1764865221132,"service":"scheduling-service","migration":"20251203_01_create_reservations.sql","msg":"Applying migration"}
{"level":30,"time":1764865221139,"service":"scheduling-service","migration":"20251203_02_create_appointments.sql","msg":"Applying migration"}
{"level":30,"time":1764865221146,"service":"scheduling-service","migration":"20251203_03_alter_reservations_nullable_expires.sql","msg":"Applying migration"}
{"level":30,"time":1764865221196,"service":"scheduling-service","migration":"20251203_create_idempotency_keys.sql","msg":"Applying migration"}
{"level":30,"time":1764865221197,"service":"scheduling-service","executed":4,"msg":"All migrations applied"}
{"level":30,"time":1764865221778,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221784,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221786,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221787,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221788,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221788,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221792,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221793,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221795,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221795,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221797,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221797,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221799,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221800,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221802,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221802,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221805,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221805,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221812,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221812,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221814,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221815,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221816,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221816,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221817,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221818,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221818,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221819,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221819,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221819,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221820,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221820,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221820,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221820,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221821,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221821,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221821,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221821,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865221822,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865221822,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":40,"time":1764865221865,"service":"scheduling-service","token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","msg":"Using stub slot client — always returning valid token"}
{"level":30,"time":1764865221901,"service":"scheduling-service","req":{"id":1,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62553","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-0","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62573},"res":{"statusCode":201,"headers":{"content-type":"application/json; charset=utf-8","content-length":"453","etag":"W/\"1c5-TsgB/ePJtzFlBhA7LOXphh5Htpk\""}},"responseTime":123,"msg":"request completed"}
{"level":50,"time":1764865221904,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221914,"service":"scheduling-service","req":{"id":2,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62554","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-1","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62574},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":128,"msg":"request completed"}
{"level":50,"time":1764865221921,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221922,"service":"scheduling-service","req":{"id":3,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62555","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-2","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62575},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":134,"msg":"request completed"}
{"level":50,"time":1764865221931,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221934,"service":"scheduling-service","req":{"id":10,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62562","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-9","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62582},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":122,"msg":"request completed"}
{"level":50,"time":1764865221937,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221938,"service":"scheduling-service","req":{"id":12,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62564","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-11","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62584},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":123,"msg":"request completed"}
{"level":50,"time":1764865221944,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221945,"service":"scheduling-service","req":{"id":4,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62556","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-3","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62576},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":153,"msg":"request completed"}
{"level":50,"time":1764865221948,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221950,"service":"scheduling-service","req":{"id":7,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62559","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-6","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62579},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":151,"msg":"request completed"}
{"level":50,"time":1764865221953,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221953,"service":"scheduling-service","req":{"id":8,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62560","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-7","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62580},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":151,"msg":"request completed"}
{"level":50,"time":1764865221955,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221961,"service":"scheduling-service","req":{"id":6,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62558","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-5","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62578},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":163,"msg":"request completed"}
{"level":50,"time":1764865221964,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221965,"service":"scheduling-service","req":{"id":9,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62561","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-8","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62581},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":160,"msg":"request completed"}
{"level":50,"time":1764865221968,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221969,"service":"scheduling-service","req":{"id":5,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62557","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-4","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62577},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":174,"msg":"request completed"}
{"level":50,"time":1764865221971,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221971,"service":"scheduling-service","req":{"id":11,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62563","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-10","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62583},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":157,"msg":"request completed"}
{"level":50,"time":1764865221972,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221973,"service":"scheduling-service","req":{"id":20,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62572","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-19","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62592},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":151,"msg":"request completed"}
{"level":50,"time":1764865221978,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221979,"service":"scheduling-service","req":{"id":14,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62566","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-13","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62586},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":161,"msg":"request completed"}
{"level":50,"time":1764865221982,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221982,"service":"scheduling-service","req":{"id":13,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62565","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-12","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62585},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":165,"msg":"request completed"}
{"level":50,"time":1764865221985,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221985,"service":"scheduling-service","req":{"id":15,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62567","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-14","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62587},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":166,"msg":"request completed"}
{"level":50,"time":1764865221987,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221988,"service":"scheduling-service","req":{"id":16,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62568","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-15","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62588},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":168,"msg":"request completed"}
{"level":50,"time":1764865221989,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221990,"service":"scheduling-service","req":{"id":17,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62569","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-16","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62589},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":170,"msg":"request completed"}
{"level":50,"time":1764865221995,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221996,"service":"scheduling-service","req":{"id":18,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62570","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-17","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62590},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":175,"msg":"request completed"}
{"level":50,"time":1764865221998,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","err":{"type":"ConflictError","message":"Reservation token expired or already confirmed","stack":"ConflictError: Reservation token expired or already confirmed\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/application/services/appointmentService.ts:61:15\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Module.withTransaction (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/packages/shared/dist/db/index.js:29:24)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:43:27","name":"ConflictError","status":409},"status":409,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865221999,"service":"scheduling-service","req":{"id":19,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62571","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-18","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62591},"res":{"statusCode":409,"headers":{"content-type":"application/json; charset=utf-8","content-length":"84","etag":"W/\"54-Sa+D4nPuGixldKsJ7/GoUWFFKnY\""}},"responseTime":178,"msg":"request completed"}
{"level":30,"time":1764865222004,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","method":"POST","path":"/agendamentos","msg":"Incoming request"}
{"level":30,"time":1764865222004,"service":"scheduling-service","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","route":"/agendamentos","payload":{"clientId":"f4e2d667-82d2-4aff-9f8e-4d27f698e9f3","unitId":"f62e5d42-7b61-49da-8b44-64df61de708c","serviceId":"90b9f6d8-46f9-4f53-b91b-f2078fc9f2c1","start":"2025-12-03T15:00:00.000Z","reservationToken":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","origin":"cliente"},"msg":"Creating appointment"}
{"level":30,"time":1764865222007,"service":"scheduling-service","req":{"id":21,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62603","accept-encoding":"gzip, deflate","x-reservation-token":"resv_0ec5b38d-d807-48cd-b4de-177aeb01ca3d","idempotency-key":"concurrency-0","content-type":"application/json","content-length":"267","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62604},"res":{"statusCode":201,"headers":{"content-type":"application/json; charset=utf-8","content-length":"453","etag":"W/\"1c5-/Am8Lg+GV6EXNgf9siuKBHhpyG8\""}},"responseTime":3,"msg":"request completed"}
 ✓ tests/integration/booking_concurrency.test.ts  (1 test) 1029ms
{"level":40,"time":1764865224022,"service":"scheduling-service","token":"resv_c4209a2a-99c5-4549-9382-9e0454a265f4","msg":"Using stub slot client — always returning valid token"}
{"level":50,"time":1764865224277,"service":"scheduling-service","err":{"type":"ZodError","message":"[\n  {\n    \"code\": \"invalid_type\",\n    \"expected\": \"string\",\n    \"received\": \"undefined\",\n    \"path\": [\n      \"clientId\"\n    ],\n    \"message\": \"Required\"\n  },\n  {\n    \"code\": \"invalid_type\",\n    \"expected\": \"string\",\n    \"received\": \"undefined\",\n    \"path\": [\n      \"unitId\"\n    ],\n    \"message\": \"Required\"\n  },\n  {\n    \"code\": \"invalid_type\",\n    \"expected\": \"string\",\n    \"received\": \"undefined\",\n    \"path\": [\n      \"serviceId\"\n    ],\n    \"message\": \"Required\"\n  },\n  {\n    \"code\": \"invalid_type\",\n    \"expected\": \"string\",\n    \"received\": \"undefined\",\n    \"path\": [\n      \"start\"\n    ],\n    \"message\": \"Required\"\n  },\n  {\n    \"code\": \"invalid_type\",\n    \"expected\": \"string\",\n    \"received\": \"undefined\",\n    \"path\": [\n      \"reservationToken\"\n    ],\n    \"message\": \"Required\"\n  },\n  {\n    \"expected\": \"'cliente' | 'barbeiro' | 'admin'\",\n    \"received\": \"undefined\",\n    \"code\": \"invalid_type\",\n    \"path\": [\n      \"origin\"\n    ],\n    \"message\": \"Required\"\n  }\n]","stack":"ZodError: [\n  {\n    \"code\": \"invalid_type\",\n    \"expected\": \"string\",\n    \"received\": \"undefined\",\n    \"path\": [\n      \"clientId\"\n    ],\n    \"message\": \"Required\"\n  },\n  {\n    \"code\": \"invalid_type\",\n    \"expected\": \"string\",\n    \"received\": \"undefined\",\n    \"path\": [\n      \"unitId\"\n    ],\n    \"message\": \"Required\"\n  },\n  {\n    \"code\": \"invalid_type\",\n    \"expected\": \"string\",\n    \"received\": \"undefined\",\n    \"path\": [\n      \"serviceId\"\n    ],\n    \"message\": \"Required\"\n  },\n  {\n    \"code\": \"invalid_type\",\n    \"expected\": \"string\",\n    \"received\": \"undefined\",\n    \"path\": [\n      \"start\"\n    ],\n    \"message\": \"Required\"\n  },\n  {\n    \"code\": \"invalid_type\",\n    \"expected\": \"string\",\n    \"received\": \"undefined\",\n    \"path\": [\n      \"reservationToken\"\n    ],\n    \"message\": \"Required\"\n  },\n  {\n    \"expected\": \"'cliente' | 'barbeiro' | 'admin'\",\n    \"received\": \"undefined\",\n    \"code\": \"invalid_type\",\n    \"path\": [\n      \"origin\"\n    ],\n    \"message\": \"Required\"\n  }\n]\n    at Object.get error [as error] (file:///Users/joelsonqueiroz/CascadeProjects/scheduling-service/node_modules/zod/v3/types.js:39:31)\n    at ZodObject.parse (file:///Users/joelsonqueiroz/CascadeProjects/scheduling-service/node_modules/zod/v3/types.js:114:22)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/src/controllers/appointmentController.ts:37:54\n    at Layer.handle [as handle_request] (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/node_modules/express/lib/router/layer.js:95:5)\n    at next (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/node_modules/express/lib/router/layer.js:95:5)\n    at /Users/joelsonqueiroz/CascadeProjects/scheduling-service/node_modules/express/lib/router/index.js:284:15\n    at Function.process_params (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/node_modules/express/lib/router/index.js:346:12)\n    at next (/Users/joelsonqueiroz/CascadeProjects/scheduling-service/node_modules/express/lib/router/index.js:280:10)","aggregateErrors":[{"type":"Object","message":"Required","stack":"","code":"invalid_type","expected":"string","received":"undefined","path":["clientId"]},{"type":"Object","message":"Required","stack":"","code":"invalid_type","expected":"string","received":"undefined","path":["unitId"]},{"type":"Object","message":"Required","stack":"","code":"invalid_type","expected":"string","received":"undefined","path":["serviceId"]},{"type":"Object","message":"Required","stack":"","code":"invalid_type","expected":"string","received":"undefined","path":["start"]},{"type":"Object","message":"Required","stack":"","code":"invalid_type","expected":"string","received":"undefined","path":["reservationToken"]},{"type":"Object","message":"Required","stack":"","expected":"'cliente' | 'barbeiro' | 'admin'","received":"undefined","code":"invalid_type","path":["origin"]}],"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["clientId"],"message":"Required"},{"code":"invalid_type","expected":"string","received":"undefined","path":["unitId"],"message":"Required"},{"code":"invalid_type","expected":"string","received":"undefined","path":["serviceId"],"message":"Required"},{"code":"invalid_type","expected":"string","received":"undefined","path":["start"],"message":"Required"},{"code":"invalid_type","expected":"string","received":"undefined","path":["reservationToken"],"message":"Required"},{"expected":"'cliente' | 'barbeiro' | 'admin'","received":"undefined","code":"invalid_type","path":["origin"],"message":"Required"}],"name":"ZodError"},"status":422,"path":"/agendamentos","method":"POST","msg":"Request failed"}
{"level":40,"time":1764865224298,"service":"scheduling-service","req":{"id":1,"method":"POST","url":"/agendamentos","query":{},"params":{},"headers":{"host":"127.0.0.1:62611","accept-encoding":"gzip, deflate","content-type":"application/json","content-length":"2","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62612},"res":{"statusCode":422,"headers":{"content-type":"application/json; charset=utf-8","content-length":"1880","etag":"W/\"758-OiNhg5OLDTsbhc2NwvIjimh8t+k\""}},"responseTime":23,"msg":"request completed"}
{"level":40,"time":1764865224451,"service":"scheduling-service","req":{"id":1,"method":"GET","url":"/agendamentos/00000000-0000-0000-0000-000000000000","query":{},"params":{},"headers":{"host":"127.0.0.1:62613","accept-encoding":"gzip, deflate","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":62614},"res":{"statusCode":404,"headers":{"content-type":"application/json; charset=utf-8","content-length":"59","etag":"W/\"3b-PnFKKn8Pet2Us0wk/0PHau/Sd2w\""}},"responseTime":4,"msg":"request completed"}
 ✓ tests/controllers/appointmentController.test.ts  (3 tests) 1023ms
 ✓ tests/dtos/appointmentDto.test.ts  (4 tests) 11ms
 ✓ tests/shared/config.test.ts  (2 tests) 309ms
 ✓ tests/shared/logger.test.ts  (1 test) 271ms

 Test Files  5 passed (5)
      Tests  11 passed (11)
   Start at  13:20:16
   Duration  12.04s (transform 316ms, setup 5.26s, collect 1.69s, tests 2.64s, environment 1ms, prepare 1.07s)

